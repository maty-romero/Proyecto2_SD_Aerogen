rule_engine {
  ignore_sys_message = true
  jq_function_default_timeout = "10s"
  rules {
    rule_dqem {
      actions = [
        {
          args {
            mqtt_properties {}
            payload = ""
            qos = 1
            retain = false
            topic = "farms/${farm_id}/alerts/turbines/${turbine_id}"
            user_properties = ""
          }
          function = republish
        }
      ]
      description = ""
      enable = true
      metadata {created_at = 1762295523134}
      sql = """~
        SELECT
          payload.farm_id AS farm_id,
          payload.turbine_id AS turbine_id,
          payload.farm_name AS farm_name,
          payload.turbine_name AS turbine_name,
          payload.gear_temperature_c AS gear_temperature_c,
          'Gear temperature above normal' as message
        FROM "farms/+/turbines/+/raw_telemetry"
        WHERE payload.gear_temperature_c > 100
      ~"""
    }
  }
}
